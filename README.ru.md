# –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —á–∞—Ç-–±–æ—Ç WhatsApp GPT

–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —á–∞—Ç-–±–æ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏–π –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–∏
–±–∏–±–ª–∏–æ—Ç–µ–∫–∏ [@green-api/whatsapp-chatgpt](https://github.com/green-api/whatsapp-chatgpt-js).

## –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –¥–µ–º–æ-–±–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å –º–Ω–æ–≥–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π WhatsApp-—á–∞—Ç-–±–æ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–æ–¥–µ–ª–µ–π OpenAI GPT. –û–Ω –≤–∫–ª—é—á–∞–µ—Ç
–ø—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ –ü–û (middleware), –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π, –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ –º–Ω–æ–≥–æ–µ
–¥—Ä—É–≥–æ–µ.

## –§—É–Ω–∫—Ü–∏–∏

- ü§ñ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenAI GPT —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏
- üåê –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —è–∑—ã–∫–æ–≤ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —è–∑—ã–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- üñºÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- üîÑ –ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–º–µ—Ä–æ–≤ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ –ü–û (Middleware)
- ‚å®Ô∏è –°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥
- üß© –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ —Ç–∏–ø–∞–º
- üìù –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- üå¶Ô∏è –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (–∏–º–∏—Ç–∞—Ü–∏—è API –ø–æ–≥–æ–¥—ã)
- üé≠ –ù–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–∂–∏–º–æ–≤ –ª–∏—á–Ω–æ—Å—Ç–∏

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 20.0.0 –∏–ª–∏ –≤—ã—à–µ
- –ê–∫–∫–∞—É–Ω—Ç GREEN-API –∏ –∏–Ω—Å—Ç–∞–Ω—Å ([–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∑–¥–µ—Å—å](https://green-api.com/))
- –ö–ª—é—á API OpenAI ([–ø–æ–ª—É—á–∏—Ç—å –∑–¥–µ—Å—å](https://platform.openai.com/api-keys))

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
   ```bash
   git clone https://github.com/green-api/whatsapp-demo-chatgpt-js.git
   cd whatsapp-demo-chatgpt-js
   ```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   ```bash
   npm install
   ```

3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:
   ```
   INSTANCE_ID=–≤–∞—à_–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä_–∏–Ω—Å—Ç–∞–Ω—Å–∞_green_api
   INSTANCE_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–∏–Ω—Å—Ç–∞–Ω—Å–∞_green_api
   OPENAI_API_KEY=–≤–∞—à_–∫–ª—é—á_api_openai
   ```

4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:
   ```bash
   npm start
   ```

   –î–ª—è —Ä–µ–∂–∏–º–∞ –æ—Ç–ª–∞–¥–∫–∏ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º:
   ```bash
   npm run start:debug
   ```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–æ—Ç–∞

### –ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

–î–µ–º–æ-–±–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É `handlersFirst: true`, –∫–æ—Ç–æ—Ä–∞—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:

1. –ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
2. –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (onText, onRegex, onType) —Å–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞—é—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ:
    - –ï—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–≤–ø–∞–¥–∞–µ—Ç –∏ **–Ω–µ** –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `true`, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ (GPT –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç
      —Å–æ–æ–±—â–µ–Ω–∏–µ)
    - –ï—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–≤–ø–∞–¥–∞–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `true`, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –¥–æ GPT
    - –ï—Å–ª–∏ –Ω–∏ –æ–¥–∏–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –¥–æ GPT
3. –ï—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –¥–æ GPT (–ª–∏–±–æ –ø–æ—Ç–æ–º—É, —á—Ç–æ –Ω–∏ –æ–¥–∏–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ —Å–æ–≤–ø–∞–ª, –ª–∏–±–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —è–≤–Ω–æ –≤–µ—Ä–Ω—É–ª
   `true`), —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–µ–ª—å—é GPT

–ü–æ–Ω–∏–º–∞–Ω–∏–µ —ç—Ç–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ, –ø–æ—Å–∫–æ–ª—å–∫—É:

- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥, —Ç–∞–∫–∏–µ –∫–∞–∫ `/help` –∏ `/weather`, –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç –µ–≥–æ –≤ GPT
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ç–∏–ø–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤) –º–æ–≥—É—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ, –∞ –∑–∞—Ç–µ–º –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –µ–≥–æ –≤
  GPT, –≤–µ—Ä–Ω—É–≤ `true`
- –õ—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –Ω–µ —Å–æ–≤–ø–∞–≤—à–µ–µ —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ GPT

–ë–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ `handlersFirst: true` –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–Ω–∞—á–∞–ª–∞ –±—ã –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∏—Å—å –≤ GPT, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
–∫–æ–º–∞–Ω–¥ –∏ –¥—Ä—É–≥–∏—Ö —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤.

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ë–æ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:

```typescript
const bot = new WhatsappGptBot({
	idInstance: process.env.INSTANCE_ID || "",
	apiTokenInstance: process.env.INSTANCE_TOKEN || "",
	openaiApiKey: process.env.OPENAI_API_KEY || "",
	model: "gpt-4o",
	systemMessage: "–í—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–π –Ω–∞ —è–∑—ã–∫–µ, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –ø–∏—à–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å...",
	maxHistoryLength: 15,
	temperature: 0.5,
	handlersFirst: true,
	clearWebhookQueueOnStart: true,
});
```

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–π —É–ª—É—á—à–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:

```typescript
class EnhancedImageHandler extends ImageMessageHandler {
	async processMessage(message: Message, openai: OpenAI, model: OpenAIModel): Promise<any> {
		const result = await super.processMessage(message, openai, model);

		if (typeof result === "string") {
			return result.replace(
				"[The user sent an image",
				"[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–∏–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ. –°–∫–∞–∂–∏—Ç–µ –µ–º—É, —á—Ç–æ –≤—ã –Ω–µ —Ç–∞ –º–æ–¥–µ–ª—å..."
			);
		}

		return result;
	}
}

// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
bot.replaceHandler(ImageMessageHandler, new EnhancedImageHandler());
```

### –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ –ü–û (Middleware)

–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–º–µ—Ä–æ–≤ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ –ü–û, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏—Ö —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

#### –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –ü–û –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

```typescript
const loggingMessageMiddleware: ProcessMessageMiddleware = async (
	message, messageContent, messages, _
) => {
	console.log(`[${new Date().toISOString()}] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (${message.chatId}): `,
		typeof messageContent === "string"
			? messageContent
			: JSON.stringify(messageContent));

	return {messageContent, messages};
};

bot.addMessageMiddleware(loggingMessageMiddleware);
```

#### –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –ü–û –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

```typescript
const timeContextMiddleware: ProcessMessageMiddleware = async (
	_, messageContent, messages, __
) => {
	const systemIndex = messages.findIndex(m => m.role === "system");
	if (systemIndex >= 0 && typeof messages[systemIndex].content === "string") {
		const now = new Date();
		const timeContext = `–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: ${now.toLocaleString()}`;

		// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏
		// ...
	}

	return {messageContent, messages};
};

bot.addMessageMiddleware(timeContextMiddleware);
```

#### –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –ü–û –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

```typescript
const moderationMiddleware: ProcessMessageMiddleware = async (
	_, messageContent, messages, __
) => {
	const sensitiveKeywords = [
		"stupid", "bad", "awful",
	];

	if (typeof messageContent === "string") {
		// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –∏ –∏—Ö –ø–æ–º–µ—Ç–∫–∞ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
		// ...
	}

	return {messageContent, messages};
};

bot.addMessageMiddleware(moderationMiddleware);
```

#### –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –ü–û –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ –æ—Ç–≤–µ—Ç–æ–≤

```typescript
const signatureMiddleware: ProcessResponseMiddleware = async (
	response, messages, _
) => {
	const signature = "‚Äî GREEN-API WhatsApp GPT –±–æ—Ç";

	// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∏ –∫ –æ—Ç–≤–µ—Ç–∞–º
	// ...

	return {
		response: enhancedResponse,
		messages
	};
};

bot.addResponseMiddleware(signatureMiddleware);
```

## –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥

–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–µ–∞–ª–∏–∑—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–æ–º–∞–Ω–¥ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥:

### –ö–æ–º–∞–Ω–¥–∞ –ø–æ–º–æ—â–∏

```typescript
bot.onText("/help", async (message, _) => {
	const helpText = `*–î–µ–º–æ-–±–æ—Ç WhatsAppGPT*

–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
- /help - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–º–æ—â–∏
- /clear - –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
- /mode [professional|casual|creative] - –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∏–ª—å –æ—Ç–≤–µ—Ç–æ–≤
- /weather [–º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ] - –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–≥–æ–¥–µ (–¥–µ–º–æ)
...`;

	await bot.sendText(message.chatId, helpText);
});
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π

```typescript
bot.onText("/clear", async (message, session) => {
	// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å–∏—Å—Ç–µ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
	if (session.stateData && session.stateData.messages) {
		const systemMessage = session.stateData.messages.find(m => m.role === "system");
		session.stateData.messages = systemMessage ? [systemMessage] : [];
		await bot.sendText(message.chatId, "‚úì –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –æ—á–∏—â–µ–Ω–∞!");
	} else {
		await bot.sendText(message.chatId, "–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏.");
	}
});
```

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –ª–∏—á–Ω–æ—Å—Ç–∏

```typescript
bot.onRegex(/^\/mode\s+(professional|casual)$/i, async (message, session) => {
	// –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –∏–∑ –∫–æ–º–∞–Ω–¥—ã
	// ...

	// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–π –ø–æ–¥—Å–∫–∞–∑–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
	// ...

	await bot.sendText(message.chatId, `–†–µ–∂–∏–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω –Ω–∞ —Å—Ç–∏–ª—å *${mode}*! üé≠`);
});
```

### –î–µ–º–æ-–∫–æ–º–∞–Ω–¥–∞ –ø–æ–≥–æ–¥—ã

```typescript
bot.onRegex(/^\/weather\s+(.+)$/i, async (message, _) => {
	// –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è –∏–∑ –∫–æ–º–∞–Ω–¥—ã
	// ...

	// –ò–º–∏—Ç–∞—Ü–∏—è –≤—ã–∑–æ–≤–∞ API –ø–æ–≥–æ–¥—ã
	// ...

	await bot.sendText(
		message.chatId,
		`*–ü–æ–≥–æ–¥–∞ –¥–ª—è ${weather.location}*\n` +
		// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≥–æ–¥–µ
		// ...
	);
});
```

## –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ç–∏–ø–æ–≤

–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–µ–∞–ª–∏–∑—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π:

### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è

```typescript
bot.onType("location", async (message, _) => {
	if (!message.location) return;

	// –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏
	// ...

	// –ò–º–∏—Ç–∞—Ü–∏—è –±–ª–∏–∂–∞–π—à–∏—Ö –º–µ—Å—Ç
	// ...

	await bot.sendText(message.chatId, response);
});
```

### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

```typescript
bot.onType("document", async (message, _) => {
	if (!message.media) return;

	const fileName = message.media.fileName || "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ñ–∞–π–ª";

	await bot.sendText(
		message.chatId,
		`–Ø –ø–æ–ª—É—á–∏–ª –≤–∞—à –¥–æ–∫—É–º–µ–Ω—Ç: "${fileName}"\n\n_–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è..._`
	);
	return true;
});
```

## –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º:

```typescript
console.log("–ó–∞–ø—É—Å–∫ –¥–µ–º–æ-–±–æ—Ç–∞ WhatsApp GPT...");
bot.start().then(() => {
	console.log("–ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω!");
}).catch(error => {
	console.error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞:", error);
});

process.on("SIGINT", () => {
	console.log("–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞...");
	bot.stop();
	process.exit(0);
});
```

## –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏

–í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–Ω—É—é —Ç–æ—á–∫—É –¥–ª—è –≤–∞—à–µ–≥–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ WhatsApp GPT –±–æ—Ç–∞. –í–æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ
–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é:

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥

–ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–æ–º–∞–Ω–¥—É, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ—Ç–æ–¥—ã `onText` –∏–ª–∏ `onRegex`:

```typescript
bot.onText("/mycommand", async (message, session) => {
	// –í–∞—à–∞ –ª–æ–≥–∏–∫–∞ –∫–æ–º–∞–Ω–¥—ã –∑–¥–µ—Å—å
	await bot.sendText(message.chatId, "–û—Ç–≤–µ—Ç –Ω–∞ –º–æ—é –∫–æ–º–∞–Ω–¥—É");
});
```

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ –ü–û

–ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –ü–û, —Å–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é, —Ä–µ–∞–ª–∏–∑—É—é—â—É—é –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `ProcessMessageMiddleware` –∏–ª–∏
`ProcessResponseMiddleware`:

```typescript
const myMiddleware: ProcessMessageMiddleware = async (
	message, messageContent, messages, sessionData
) => {
	// –í–∞—à–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ –ü–û –∑–¥–µ—Å—å
	return {messageContent, messages};
};

bot.addMessageMiddleware(myMiddleware);
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π

–î–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:

```typescript
class MyCustomHandler implements MessageHandler {
	canHandle(message: Message): boolean {
		// –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ, –º–æ–∂–µ—Ç –ª–∏ —ç—Ç–æ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
		return message.type === "my-custom-type";
	}

	async processMessage(message: Message): Promise<any> {
		// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
		return "–û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç";
	}
}

bot.registerMessageHandler(new MyCustomHandler());
```

## –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω –ø–æ –ª–∏—Ü–µ–Ω–∑–∏–∏ [CC-BY-ND-4.0](https://creativecommons.org/licenses/by-nd/4.0/).
